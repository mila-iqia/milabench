_sb3:
  inherits: _defaults
  definition: ../benchmarks/stable_baselines3
  group: sb3
  plan:
    method: njobs
    n: 1

ppo:
  inherits: _sb3
  tags:
    - rl

  argv:
    --algo: ppo
    --env: HalfCheetahBulletEnv-v0
    -n: '-1'
    --num-threads: '-1'
    --seed: '0'
    --vec-env: subproc
    --device: auto
    --: [-params, n_envs:16, n_steps:512, n_epochs:20, n_timesteps:50000]

td3:
  inherits: _sb3
  tags:
    - rl

  argv:
    --algo: td3
    --env: HalfCheetahBulletEnv-v0 # Default: CartPole-v1
    --n-eval-envs: '1'
    --n-timesteps: '50000' # Default: '-1'
    --num-threads: '-1'
    --log-interval: '-1'
    --eval-episodes: '5'
    --save-freq: '-1'
    --seed: '0' # Default: -1
    --vec-env: subproc # Default: dummy
    --device: auto
    --n-trials: '10' # Default: 500
    --n-jobs: '1'


opt-1_3b-gpus:
  inherits: _accelerate_opt
  tags:
    - multigpu
  
  argv:
    --model_name: "facebook/opt-1.3b"
    --per_gpu_batch_size: 1

  use_deepspeed: false
  num_machines: 1

opt-1_3b-nodes:
  inherits: opt-1_3b-gpus

  tags:
    - multinode
  requires_capabilities:
    - "len(nodes) >= ${num_machines}"

  docker_image: "ghcr.io/mila-iqia/milabench:cuda-nightly"
  num_machines: 2

opt-6_7b-gpus:
  inherits: _accelerate_opt
  tags:
    - multigpu

  argv:
    --model_name: "facebook/opt-6.7b"
    --per_gpu_batch_size: 1

  num_machines: 1

opt-6_7b-nodes:
  inherits: opt-6_7b-gpus
  tags:
    - multinode

  requires_capabilities:
    - "len(nodes) >= ${num_machines}"

  docker_image: "ghcr.io/mila-iqia/milabench:cuda-nightly"
  num_machines: 2


opt-1_3b-gpus:
  enabled: true
  weight: 5.0

opt-1_3b-nodes:
  enabled: true
  weight: 10.0

opt-6_7b-gpus:
  enabled: true
  weight: 5.0

opt-6_7b-nodes:
  enabled: true
  weight: 10.0





#
# replace OPT
#
llm-small-gpus:
  inherits: _accelerate_opt
  tags:
    - multigpu
  
  argv:
    --model_name: "meta-llama/Meta-Llama-3.1-8B"
    --per_gpu_batch_size: 1

  use_deepspeed: false
  num_machines: 1

llm-small-nodes:
  inherits: llm-small-gpus

  tags:
    - multinode
  requires_capabilities:
    - "len(nodes) >= ${num_machines}"

  docker_image: "ghcr.io/mila-iqia/milabench:cuda-nightly"
  num_machines: 2

llm-big-gpus:
  inherits: _accelerate_opt
  tags:
    - multigpu

  argv:
    --model_name: "meta-llama/Meta-Llama-3.1-70B-Instruct"
    --per_gpu_batch_size: 1

  num_machines: 1

llm-big-nodes:
  inherits: llm-big-gpus
  tags:
    - multinode

  requires_capabilities:
    - "len(nodes) >= ${num_machines}"

  docker_image: "ghcr.io/mila-iqia/milabench:cuda-nightly"
  num_machines: 2
