defaults: &defaults
  install_variant: "{arch}"

  max_duration: 600

  voir:
    options:
      stop: 60
      interval: "1s"


torchvision: &torchvision
  <<<: *defaults

  group: torchvision
  install_group: torch

  plan:
    method: per_gpu

  argv:
    --with-amp: true
    --lr: 0.01

  definition: ../benchmarks/torchvision


hf: &hf
  <<<: *defaults

  group: hf
  install_group: torch

  plan:
    method: per_gpu

  tags:
    - rl

  definition: ../benchmarks/huggingface


lightning: &lightning
  <<<: *defaults

  group: lightning
  install_group: torch

  plan:
    method: njobs
    n: 1

  definition: ../benchmarks/pytorch-lightning

  argv:
    --gpus: -1
    --max_epochs: 1
    --max_steps: 100
    --limit_val_batches: 100
    --devices: -1
    --enable_progress_bar: "False"
    --accelerator: "auto"
    --enable_checkpointing: "False"


benchmarks:
  resnet50:
    <<<: *torchvision
    tags:
      - convnet

    argv:
      --model: resnet50

  efficientnet_b4:
    <<<: *torchvision
    tags:
      - convnet
    
    argv:
      --model: efficientnet_b4

  efficientnet_b7:
    <<<: *torchvision
    tags:
      - convnet
    
    argv:
      --model: efficientnet_b7

  convnext_large:
    <<<: *torchvision
    tags:
      - convnet

    argv:
      --model: convnext_large

  regnet_y_128gf:
    <<<: *torchvision
    tags:
      - convnet

    argv:
      --model: regnet_y_128gf

  bert:
    <<<: *hf
    tags:
      - huggingface
      - transformer
    argv:
      --model: "Bert"

  t5:
    <<<: *hf
    tags:
      - huggingface
      - transformer
    argv:
      --model: "T5"

  reformer:
    <<<: *hf
    tags:
      - huggingface
      - transformer
    argv:
      --model: "Reformer"

  resnet152:
    <<<: *lightning
    tags:
      - convnet
    argv:
      --backbone: "resnet152"
      --strategy: "dp"
      --precision: 32
      --batch_size: 2048
