defaults: &defaults
  install_variant: "{arch}"

  max_duration: 600

  voir:
    options:
      stop: 60
      interval: "1s"


torchvision: &torchvision
  <<<: *defaults

  group: torchvision
  install_group: torch

  plan:
    method: per_gpu

  argv:
    --with-amp: true
    --lr: 0.01

  definition: ../benchmarks/torchvision


hf: &hf
  <<<: *defaults

  group: hf
  install_group: torch

  plan:
    method: per_gpu

  tags:
    - rl

  definition: ../benchmarks/huggingface


timm: &timm
  <<<: *defaults

  group: timm
  install_group: torch

  plan:
    method: per_gpu

  tags:
    - vision

  argv:
    --amp: true

  definition: ../benchmarks/timm

benchmarks:
  resnet50:
    <<<: *torchvision
    tags:
      - convnet

    argv:
      --model: resnet50

  efficientnet_b4:
    <<<: *torchvision
    tags:
      - convnet
    
    argv:
      --model: efficientnet_b4

  efficientnet_b7:
    <<<: *torchvision
    tags:
      - convnet
    
    argv:
      --model: efficientnet_b7

  convnext_large:
    <<<: *torchvision
    tags:
      - convnet

    argv:
      --model: convnext_large

  regnet_y_128gf:
    <<<: *torchvision
    tags:
      - convnet

    argv:
      --model: regnet_y_128gf

  bert:
    <<<: *hf
    tags:
      - huggingface
      - transformer
    argv:
      --model: "Bert"

  t5:
    <<<: *hf
    tags:
      - huggingface
      - transformer
    argv:
      --model: "T5"

  reformer:
    <<<: *hf
    tags:
      - huggingface
      - transformer
    argv:
      --model: "Reformer"

  resnet152:
    <<<: *timm
    tags:
      - convnet

    plan:
      method: njobs
      n: 1

    argv:
      --model: resnet152

  vit_l_32:
    <<<: *timm

    plan:
      method: njobs
      n: 1

    argv:
      --model: vit_large_patch32_224

  accelerate:
    <<<: *defaults

    install_group: torch

    plan:
      method: njobs
      n: 1

    # This is for single-node
    manager_addr: "127.0.0.1"
    manager_port: 10000

    num_processes: 2
    cpus_per_gpu: 8

    # model_name: "facebook/opt-350m"
    model_name: "facebook/opt-2.7b"
    #model_name: "facebook/opt-1.3b"
    #model_name: "facebook/opt-125m"

    gradient_accumulation_steps: 1
    per_gpu_batch_size: 1
    max_train_steps: 30

    dataset_name: "wikitext"
    dataset_config_name: "wikitext-103-v1"
    validation_split_percentage: 5

    definition: ../benchmarks/accelerate_opt

  focalnet:
    <<<: *timm

    plan:
      method: per_gpu

    argv:
      --model: focalnet_small_lrf

  stargan:
    <<<: *defaults

    group: stargan
    install_group: torch
    argv:
      --image_size: 512
      --c_dim: 5
      --batch_size: 16

    definition: ../benchmarks/stargan
