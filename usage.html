<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Install &mdash; milabench  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Benchmark configuration" href="config.html" />
    <link rel="prev" title="Welcome to milabench’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> milabench
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="#using-milabench">Using milabench</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#important-options">Important options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#milabench-install">milabench install</a></li>
<li class="toctree-l2"><a class="reference internal" href="#milabench-prepare">milabench prepare</a></li>
<li class="toctree-l2"><a class="reference internal" href="#milabench-run">milabench run</a></li>
<li class="toctree-l2"><a class="reference internal" href="#milabench-report">milabench report</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Benchmark configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrument.html">Instrumenting code</a></li>
<li class="toctree-l1"><a class="reference internal" href="new_benchmarks.html">Creating a new benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">milabench</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Install</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="install">
<h1>Install<a class="headerlink" href="#install" title="Permalink to this headline"></a></h1>
<p>To install for development, clone the repo and use branch <code class="docutils literal notranslate"><span class="pre">v2</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># You may need to upgrade pip</span>
pip install pip -U
git clone -b v2 git@github.com:mila-iqia/milabench.git
<span class="nb">cd</span> milabench
<span class="c1"># &lt;Activate virtual environment&gt;</span>
<span class="c1"># Install in editable mode</span>
pip install -e .
</pre></div>
</div>
<p>This will install two commands, <code class="docutils literal notranslate"><span class="pre">milabench</span></code> and <code class="docutils literal notranslate"><span class="pre">voir</span></code>.</p>
<p>There is an important second step, which is to set the environment variable <code class="docutils literal notranslate"><span class="pre">$MILABENCH_DEVREQS</span></code> to <code class="docutils literal notranslate"><span class="pre">devreq.txt</span></code>. This will make <code class="docutils literal notranslate"><span class="pre">milabench</span></code> install your working version of <code class="docutils literal notranslate"><span class="pre">milabench</span></code> into the benchmark venvs. Otherwise it won’t work at all because it will try to get it from pip. As that file is written, it will only work if you call <code class="docutils literal notranslate"><span class="pre">milabench</span></code> from the <code class="docutils literal notranslate"><span class="pre">milabench</span></code> root directory, but you can edit them to point to the absolute locations if you want.</p>
</section>
<section id="using-milabench">
<h1>Using milabench<a class="headerlink" href="#using-milabench" title="Permalink to this headline"></a></h1>
<p>To use <code class="docutils literal notranslate"><span class="pre">milabench</span></code>, you need:</p>
<ul class="simple">
<li><p>A YAML configuration file to define the benchmarks to install, prepare or run.</p></li>
<li><p>The base directory for code, virtual environments, data and outputs, set either with the <code class="docutils literal notranslate"><span class="pre">$MILABENCH_BASE</span></code> environment variable or the <code class="docutils literal notranslate"><span class="pre">--base</span></code> option. The base directory will be automatically constructed by milabench and will be organized as follows:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$MILABENCH_BASE/
|- venv/                            # Virtual environments and dependencies
|  |- bench1/                       # venv for benchmark bench1
|  |- ...                           # etc
|- code/                            # Benchmark code
|  |- bench1/                       # Code for benchmark bench1
|  |- ...                           # etc
|- data/                            # Datasets
|  |- dataset1/                     # A dataset
|  |- ...                           # etc
|- runs/                            # Outputs of benchmark runs
   |- calimero.2022-03-30_15:00:00/ # Auto-generated run name
   |  |- bench1.0.json              # Output for the first run of bench1
   |  |- bench1.1.json              # Output for the second run of bench1
   |  |- ...                        # etc
   |- blah/                         # Can set name with --run
</pre></div>
</div>
<p>It is possible to change the structure in the YAML to e.g. force benchmarks to all use the same virtual environment.</p>
<section id="important-options">
<h2>Important options<a class="headerlink" href="#important-options" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">--select</span></code> option with a comma-separated list of benchmarks in order to only install/prepare/run these benchmarks (or use <code class="docutils literal notranslate"><span class="pre">--exclude</span></code> to run all benchmarks except a specific set).</p></li>
<li><p>You may use <code class="docutils literal notranslate"><span class="pre">--use-current-env</span></code> to force the use the currently active virtual environment (useful for development).</p></li>
</ul>
</section>
<section id="milabench-install">
<h2>milabench install<a class="headerlink" href="#milabench-install" title="Permalink to this headline"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>milabench install benchmarks.yaml --select mybench
</pre></div>
</div>
<ul class="simple">
<li><p>Copies the code for the benchmark (specified in the <code class="docutils literal notranslate"><span class="pre">definition</span></code> field of the benchmark’s YAML, relative to the YAML file itself) into <code class="docutils literal notranslate"><span class="pre">$MILABENCH_BASE/code/mybench</span></code>. Only files listed by the <code class="docutils literal notranslate"><span class="pre">manifest</span></code> file are copied.</p></li>
<li><p>Creates/reuses a virtual environment in <code class="docutils literal notranslate"><span class="pre">$MILABENCH_BASE/venv/mybench</span></code> and installs all pip dependencies in it.</p></li>
<li><p>Optionally extracts a shallow git clone of an external repository containing model code into <code class="docutils literal notranslate"><span class="pre">$MILABENCH_BASE/code/mybench</span></code>.</p></li>
</ul>
</section>
<section id="milabench-prepare">
<h2>milabench prepare<a class="headerlink" href="#milabench-prepare" title="Permalink to this headline"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>milabench prepare benchmarks.yaml --select mybench
</pre></div>
</div>
<ul class="simple">
<li><p>Prepares data for the benchmark into <code class="docutils literal notranslate"><span class="pre">$MILABENCH_BASE/data/dataset_name</span></code>. Multiple benchmarks can share the same data. Some benchmarks need no preparation, so the prepare step does nothing.</p></li>
</ul>
</section>
<section id="milabench-run">
<h2>milabench run<a class="headerlink" href="#milabench-run" title="Permalink to this headline"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>milabench run benchmarks.yaml --select mybench
</pre></div>
</div>
<ul class="simple">
<li><p>Creates a certain number of tasks from the benchmark using the <code class="docutils literal notranslate"><span class="pre">plan</span></code> defined in the YAML. For instance, one plan might be to run it in parallel on each GPU on the machine.</p></li>
<li><p>For each task, runs the benchmark installed in <code class="docutils literal notranslate"><span class="pre">$MILABENCH_BASE/code/mybench</span></code> in the appropriate virtual environment.</p></li>
<li><p>The benchmark is run from that directory using a command like <code class="docutils literal notranslate"><span class="pre">voir</span> <span class="pre">[VOIR_OPTIONS]</span> <span class="pre">main.py</span> <span class="pre">[SCRIPT_OPTIONS]</span></code>
* Both option groups are defined in the YAML.
* The VOIR_OPTIONS determine which instruments to use and what data to forward to milabench.
* The SCRIPT_OPTIONS are benchmark dependent.</p></li>
<li><p>Standard output/error and other data (training rates, etc.) are forwarded to the main dispatcher process and saved into <code class="docutils literal notranslate"><span class="pre">$MILABENCH_BASE/runs/run_name/mybench.run_number.json</span></code> (the name of the directory is printed out for easy reference).</p></li>
</ul>
</section>
<section id="milabench-report">
<h2>milabench report<a class="headerlink" href="#milabench-report" title="Permalink to this headline"></a></h2>
<p>TODO.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>milabench report benchmarks.yaml --run &lt;run_name&gt;
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to milabench’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="config.html" class="btn btn-neutral float-right" title="Benchmark configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Mila IDT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>