"""Add new indexes

Revision ID: c7fd8856e79c
Revises: 94b7d2c950a4
Create Date: 2025-07-15 11:24:20.223515

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = 'c7fd8856e79c'
down_revision: Union[str, None] = '94b7d2c950a4'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('execs_meta_gpus_0_product_idx'), table_name='execs')
    op.create_index('execs_meta_gpus_0_product_idx', 'execs', [sa.literal_column("(meta -> 'accelerators' -> 'gpus' -> '0' ->> 'product')")], unique=False, postgresql_using='btree')
    # op.create_index('idx_exec_meta_accelerators_gin', 'execs', [sa.literal_column("meta -> 'accelerators'")], unique=False, postgresql_using='gin')
    # op.create_index('idx_exec_meta_pytorch_gin', 'execs', [sa.literal_column("meta -> 'pytorch'")], unique=False, postgresql_using='gin')
    op.create_index('idx_exec_meta_pytorch_torch', 'execs', [sa.literal_column("(meta -> 'pytorch' ->> 'torch')")], unique=False, postgresql_using='btree')
    op.create_index('idx_exec_meta_pytorch_version', 'execs', [sa.literal_column("(meta -> 'pytorch' ->> 'version')")], unique=False, postgresql_using='btree')
    op.create_index('idx_metric_exec_name', 'metrics', ['exec_id', 'name'], unique=False)
    op.create_index('idx_metric_exec_pack_name', 'metrics', ['exec_id', 'pack_id', 'name'], unique=False)
    op.create_index('idx_metric_name_value', 'metrics', ['name', 'value'], unique=False)
    op.create_index('idx_metric_pack_name', 'metrics', ['pack_id', 'name'], unique=False)
    op.create_index('idx_pack_name', 'packs', ['name'], unique=False)
    op.create_index('idx_weight_pack', 'weights', ['pack'], unique=False)
    op.create_index('idx_weight_profile_enabled', 'weights', ['profile', 'enabled'], unique=False)
    op.create_index('idx_weight_profile_priority', 'weights', ['profile', 'priority'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index('idx_weight_profile_priority', table_name='weights')
    op.drop_index('idx_weight_profile_enabled', table_name='weights')
    op.drop_index('idx_weight_pack', table_name='weights')
    op.drop_index('idx_pack_name', table_name='packs')
    op.drop_index('idx_metric_pack_name', table_name='metrics')
    op.drop_index('idx_metric_name_value', table_name='metrics')
    op.drop_index('idx_metric_exec_pack_name', table_name='metrics')
    op.drop_index('idx_metric_exec_name', table_name='metrics')
    op.drop_index('idx_exec_meta_pytorch_version', table_name='execs', postgresql_using='btree')
    op.drop_index('idx_exec_meta_pytorch_torch', table_name='execs', postgresql_using='btree')
    op.drop_index('idx_exec_meta_pytorch_gin', table_name='execs', postgresql_using='gin')
    op.drop_index('idx_exec_meta_accelerators_gin', table_name='execs', postgresql_using='gin')
    op.drop_index('execs_meta_gpus_0_product_idx', table_name='execs', postgresql_using='btree')
    op.create_index(op.f('execs_meta_gpus_0_product_idx'), 'execs', [sa.literal_column("((((meta -> 'accelerators'::text) -> 'gpus'::text) -> '0'::text) ->> 'product'::text)")], unique=False)
    # ### end Alembic commands ###
